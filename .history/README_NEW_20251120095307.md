# Image Processing Studio

## Overview

This application provides a comprehensive, user-friendly interface for applying various image processing operations using OpenCV in Python. The GUI allows users to load images, apply transformations with interactive previews, and see the corresponding OpenCV code in real-time.

## Features

- **Interactive GUI**: Modern, easy-to-use interface with real-time image preview
- **Live Code Display**: See the exact OpenCV code for each operation
- **Undo/Redo Functionality**: Full history tracking for all operations
- **Zoom Controls**: Zoom in/out, fit to window, or reset to 100%
- **Multiple Processing Categories**:
  - Color Space Conversions (RGB, HSV, Grayscale)
  - Geometric Transformations (Resize, Flip, Rotate, Move, Perspective)
  - Filters & Enhancement (Gaussian Blur, Median Blur, Histogram Equalization, Contrast Enhancement)
  - Segmentation & Edge Detection (Global/Adaptive Thresholding, Canny Edge)
  - Morphological Operations (Erode, Dilate, Open, Close, Gradient, TopHat, BlackHat)
  - Intensity Transformations (Log Transform, Power/Gamma Transform)
  - Advanced Processing (Image Registration, Image Stitching/Panorama)
  - Drawing Tools (Line, Rectangle, Circle, Text)

## Project Structure

```
BTL/
├── main.py              # Application entry point
├── Gui.py              # GUI implementation and layout
├── process.py          # Image processing functions
├── nhap.py             # Additional utilities
└── README.md           # This file
```

### Module Descriptions

#### `main.py`
Entry point of the application. Initializes and runs the GUI.

#### `Gui.py`
Contains the `GUI` class that handles:
- Window layout and widget creation
- User interactions and event handling
- Image display and zoom controls
- History management (undo/redo)
- Code display area
- Integration with processing functions

#### `process.py`
Contains the `FunctionsProcessing` class with all image processing operations organized into categories:

1. **Color Space Conversions**
   - `cvt_RGB()` - Convert BGR to RGB
   - `cvt_HSV()` - Convert BGR to HSV
   - `cvt_GRAY()` - Convert BGR to Grayscale

2. **Filters & Enhancement**
   - `equalized_image()` - Histogram equalization
   - `gaussian_blur_dialog()` - Gaussian blur with adjustable kernel
   - `median_blur_dialog()` - Median blur for noise reduction
   - `contrast_enhancement_dialog()` - Linear and CLAHE contrast enhancement

3. **Geometric Transformations**
   - `rotate_image()` - Rotate by 90 degrees
   - `resize_image()` - Custom resize with dimensions or percentage
   - `flip_image()` - Flip horizontal/vertical/both
   - `move_image()` - Translate in X/Y directions
   - `rotationMatrix2d()` - Custom rotation with angle and scale
   - `perspective()` - Perspective transformation with point selection

4. **Segmentation & Edge Detection**
   - `threshold_image()` - Global thresholding with multiple modes
   - `adaptive_threshold_dialog()` - Adaptive thresholding
   - `canny_detection()` - Canny edge detection

5. **Morphological Operations**
   - `morph_operations_dialog()` - Erode, dilate, open, close, gradient, tophat, blackhat

6. **Intensity Transformations**
   - `log_transform_dialog()` - Logarithmic transformation (enhance dark regions)
   - `power_transform_dialog()` - Power-law (gamma) transformation
   - `contrast_enhancement_dialog()` - Contrast and brightness adjustment

7. **Advanced Processing**
   - `image_registration_dialog()` - Register/align two images using feature matching
   - `image_stitching_dialog()` - Stitch multiple images to create panoramas

8. **Drawing Utilities**
   - `draw_Line()` - Draw lines with custom color and thickness
   - `draw_Rectangle()` - Draw rectangles with fill option
   - `draw_Circle()` - Draw circles with fill option
   - `put_Text()` - Add text with custom font and style

9. **Helper Functions**
   - `_create_basic_preview_dialog()` - Create standard dialog structure
   - `_update_preview_canvas()` - Update canvas with preview image

## Getting Started

### Prerequisites

- Python 3.7 or higher
- OpenCV (`cv2`)
- Pillow (PIL)
- NumPy
- Tkinter (usually comes with Python)

### Installation

1. Clone this repository:
   ```bash
   git clone https://github.com/nvthach124/Visualize_image_processing_app.git
   cd Visualize_image_processing_app/BTL
   ```

2. Install required packages:
   ```bash
   pip install opencv-python opencv-contrib-python pillow numpy
   ```

### Usage

Run the main script to start the application:

```bash
python main.py
```

## Key Features Explained

### 1. Interactive Dialogs
Most processing functions open interactive dialogs with:
- Real-time preview of the operation
- Adjustable parameters using sliders and controls
- Apply/Cancel buttons for user control

### 2. Code Generation
Every operation generates the corresponding OpenCV Python code, which is:
- Displayed in the code panel at the bottom
- Accumulated as you apply multiple operations
- Can be copied and used in your own projects

### 3. History Management
- Full undo/redo support for all operations
- Navigate through your editing history
- Reset to original image at any time

### 4. Zoom and Navigation
- Zoom in/out for detailed work
- Fit image to window
- Scrollbars for navigating large images

## OpenCV Functions Reference

### Color Space Conversion

```python
# Convert BGR to Grayscale
gray_image = cv2.cvtColor(image, cv2.COLOR_BGR2GRAY)

# Convert BGR to HSV
hsv_image = cv2.cvtColor(image, cv2.COLOR_BGR2HSV)

# Convert BGR to RGB
rgb_image = cv2.cvtColor(image, cv2.COLOR_BGR2RGB)
```

### Geometric Transformations

#### Resize
```python
resized = cv2.resize(image, (width, height), interpolation=cv2.INTER_LINEAR)
```

#### Flip
```python
flipped = cv2.flip(image, flipCode)
# flipCode: 0=vertical, 1=horizontal, -1=both
```

#### Rotate
```python
rotated = cv2.rotate(image, cv2.ROTATE_90_CLOCKWISE)

# Custom rotation
M = cv2.getRotationMatrix2D(center, angle, scale)
rotated = cv2.warpAffine(image, M, (width, height))
```

#### Translate
```python
M = np.float32([[1, 0, tx], [0, 1, ty]])
translated = cv2.warpAffine(image, M, (width, height))
```

#### Perspective Transform
```python
M = cv2.getPerspectiveTransform(src_points, dst_points)
warped = cv2.warpPerspective(image, M, (width, height))
```

### Filtering and Enhancement

#### Gaussian Blur
```python
blurred = cv2.GaussianBlur(image, (ksize, ksize), 0)
```

#### Median Blur
```python
blurred = cv2.medianBlur(image, ksize)
```

#### Histogram Equalization
```python
equalized = cv2.equalizeHist(gray_image)

# CLAHE for color images
lab = cv2.cvtColor(image, cv2.COLOR_BGR2LAB)
l, a, b = cv2.split(lab)
clahe = cv2.createCLAHE(clipLimit=2.0, tileGridSize=(8,8))
l = clahe.apply(l)
enhanced = cv2.cvtColor(cv2.merge([l,a,b]), cv2.COLOR_LAB2BGR)
```

#### Contrast Enhancement
```python
enhanced = cv2.convertScaleAbs(image, alpha=contrast, beta=brightness)
```

### Segmentation & Edge Detection

#### Global Thresholding
```python
_, binary = cv2.threshold(gray, threshold, maxval, cv2.THRESH_BINARY)
```

#### Adaptive Thresholding
```python
binary = cv2.adaptiveThreshold(gray, 255, cv2.ADAPTIVE_THRESH_GAUSSIAN_C, 
                                cv2.THRESH_BINARY, blockSize, C)
```

#### Canny Edge Detection
```python
edges = cv2.Canny(image, threshold1, threshold2)
```

### Morphological Operations

```python
kernel = cv2.getStructuringElement(cv2.MORPH_RECT, (ksize, ksize))

eroded = cv2.erode(image, kernel, iterations=1)
dilated = cv2.dilate(image, kernel, iterations=1)
opened = cv2.morphologyEx(image, cv2.MORPH_OPEN, kernel)
closed = cv2.morphologyEx(image, cv2.MORPH_CLOSE, kernel)
gradient = cv2.morphologyEx(image, cv2.MORPH_GRADIENT, kernel)
tophat = cv2.morphologyEx(image, cv2.MORPH_TOPHAT, kernel)
blackhat = cv2.morphologyEx(image, cv2.MORPH_BLACKHAT, kernel)
```

### Intensity Transformations

#### Log Transform
```python
c = 1.0
normalized = image.astype(np.float32) / 255.0
log_img = c * np.log1p(normalized)
result = np.clip(log_img * 255, 0, 255).astype(np.uint8)
```

#### Power Transform (Gamma Correction)
```python
gamma = 1.0
c = 1.0
normalized = image.astype(np.float32) / 255.0
power_img = c * np.power(normalized, gamma)
result = np.clip(power_img * 255, 0, 255).astype(np.uint8)
```

### Advanced Processing

#### Image Registration
```python
# Feature detection
detector = cv2.ORB_create()  # or cv2.SIFT_create()
kp1, des1 = detector.detectAndCompute(img1, None)
kp2, des2 = detector.detectAndCompute(img2, None)

# Feature matching
matcher = cv2.BFMatcher(cv2.NORM_HAMMING)
matches = matcher.knnMatch(des1, des2, k=2)

# Find homography and warp
H, mask = cv2.findHomography(src_pts, dst_pts, cv2.RANSAC)
registered = cv2.warpPerspective(img2, H, (w, h))
```

#### Image Stitching
```python
stitcher = cv2.Stitcher_create(cv2.Stitcher_PANORAMA)
status, panorama = stitcher.stitch(images)
```

### Drawing Functions

```python
# Line
cv2.line(image, (x1, y1), (x2, y2), color, thickness)

# Rectangle
cv2.rectangle(image, (x1, y1), (x2, y2), color, thickness)
cv2.rectangle(image, (x1, y1), (x2, y2), color, -1)  # Filled

# Circle
cv2.circle(image, (cx, cy), radius, color, thickness)
cv2.circle(image, (cx, cy), radius, color, -1)  # Filled

# Text
cv2.putText(image, text, (x, y), font, scale, color, thickness, cv2.LINE_AA)
```

## Keyboard Shortcuts

- `Ctrl+O`: Open image
- `Ctrl+S`: Save image
- `Ctrl+Z`: Undo
- `Ctrl+Y`: Redo
- `Ctrl+R`: Reset to original image
- `+`: Zoom in
- `-`: Zoom out

## Code Architecture

### Dependency Injection Pattern
The application uses dependency injection for PIL modules to maintain loose coupling:

```python
# In Gui.py
self.pil_image_module = Image
self.pil_image_tk_module = ImageTk
self.fp = FunctionsProcessing(self.pil_image_module, self.pil_image_tk_module)
```

This allows `process.py` to remain independent of PIL imports while still using PIL functionality.

### Return Value Convention
All processing functions return a tuple:
```python
return (processed_image, code_string)
```

Where:
- `processed_image`: The resulting numpy array (OpenCV format)
- `code_string`: Python code snippet showing how to reproduce the operation

## Contributing

Contributions to improve the application are welcome! Areas for contribution:
- Adding new image processing operations
- Improving UI/UX
- Performance optimizations
- Bug fixes
- Documentation improvements

## License

This project is open source and available for educational purposes.

## Authors

- [nvthach124](https://github.com/nvthach124)

## Acknowledgments

- Built with OpenCV, the leading computer vision library
- GUI powered by Tkinter
- Image handling with PIL/Pillow
